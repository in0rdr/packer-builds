#version=RHEL8
ignoredisk --only-use=sda
clearpart --none --initlabel
autopart --type=lvm

cmdline

# Use network installation
repo --name="AppStream" --baseurl="http://mirror.centos.org/centos/8/AppStream/x86_64/os/"
url --url="http://mirror.centos.org/centos/8/BaseOS/x86_64/os/"

# Keyboard layouts
keyboard --vckeymap=us --xlayouts='us'
# System language
lang en_US.UTF-8
# System timezone
timezone Europe/Zurich --isUtc

# Network information
network --bootproto=dhcp --device=link --ipv6=auto --activate
network --hostname=localhost.localdomain

# Root password
rootpw root

# Do not configure the X Window System
skipx
# System services
services --enabled=sshd,chronyd
firewall --enabled --service=ssh

reboot

%packages
@core
@^minimal install
qemu-guest-agent
cloud-init
cloud-utils-growpart
%end

# once the installation is complete,
# but before the system is rebooted for the first time
%post
# disable cloud-init
#touch /etc/cloud/cloud-init.disabled
# reset cloud-init
rm -rf /var/lib/cloud

# change cloud-init default user
sed -i \
  -e 's/name: cloud-user/name: centos/' \
  /etc/cloud/cloud.cfg

# resolve fqdn/hostname to public address
sed -i \
  -e 's/127.0.0.1 {{fqdn}} {{hostname}}/#127.0.0.1 {{fqdn}} {{hostname}}/' \
  -e 's/::1 {{fqdn}} {{hostname}}/#::1 {{fqdn}} {{hostname}}/' \
  /etc/cloud/templates/hosts.redhat.tmpl
%end

